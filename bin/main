#!/usr/bin/env ruby
require '../lib/linter_cops'

js_files = Dir.glob('../**/*.js')
puts "inspecting #{js_files.length} file(s)"
sleep(0.8)
if js_files.empty?
  puts 'there are no available Javascript files'
else
  error_count = 0
  error_files = {}
  js_files.each do |file|
    js_linters = LinterCop.new(file)
    6.times do |i|
      print "#{file} Checking" + ('.' * (i % 3)) + "  \r"
      $stdout.flush
      sleep(0.5)
    end
    puts "#{js_linters.file_name} is Empty" if js_linters.empty_file?
    next if js_linters.empty_file?

    js_linters.semicolon_check
    js_linters.trailing_space
    js_linters.parenthesis_check
    js_linters.bracket_check
    js_linters.array_check
    js_linters.check_classname
    js_linters.last_line_space_check
    js_linters.error_sort(js_linters.error_msg).each do |err|
      puts "#{js_linters.file}:#{err}"
      error_count += 1
      error_files[js_linters.file_name] = 'err'
    end
  end

  puts "There are #{error_count} lint errors from #{error_files.length}/#{js_files.length} js files"
end
